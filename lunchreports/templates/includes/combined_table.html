{% load custom_filters %}
<tbody>
  {% for teacher_name, student_data in teacher_student_data.items %}
    {% if teacher_name != '-' %}
      <tr>
        <td rowspan="{{ student_data|length|add:1 }}">{{ teacher_name }}</td>
        <td>{{ student_data.0 }}</td>
        {% for item in lunch_items %}
          {% with total=orders_detail|get_item:item.name|get_item:teacher_name %}
            {% if total %}
              {% with quantity=total.customers|get_item:student_data.0 %}
                <td>{{ quantity|default:"-" }}</td>
              {% endwith %}
            {% else %}
              <td>-</td>
            {% endif %}
          {% endwith %}
        {% endfor %}
      </tr>
    {% endif %}

    {% for student_name in student_data|slice:"1:" %}
      <tr>
        {% if teacher_name == '-' %}
          <td>{{ teacher_name }}</td>
        {% endif %}
        <td>{{ student_name }}</td>
        {% for item in lunch_items %}
          {% with total=orders_detail|get_item:item.name|get_item:teacher_name %}
            {% if total %}
              {% with quantity=total.customers|get_item:student_name %}
                <td>{{ quantity|default:"-" }}</td>
              {% endwith %}
            {% else %}
              <td>-</td>
            {% endif %}
          {% endwith %}
        {% endfor %}
      </tr>
    {% endfor %}

    {% if teacher_name != '-' %}
      <tr>
        <td>Total</td>
        {% for item in lunch_items %}
          {% with total=orders_detail|get_item:item.name|get_item:teacher_name %}
            <td>{{ total.group_quantity|default:"-" }}</td>
          {% endwith %}
        {% endfor %}
      </tr>
    {% endif %}
  {% endfor %}
</tbody>