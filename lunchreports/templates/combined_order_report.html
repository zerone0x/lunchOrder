{% extends "base.html" %}
{% load custom_filters %}
{% block title %}
{{ title }}
{% endblock %}
{% block content %}
<h1>{{ title }}</h1>

<table>
  <tr>
      <th rowspan="2">Teacher</th>
      <th rowspan="2">Student</th>
      {% for item in lunch_items %}
      <th>{{ item.name }}</th>
      {% endfor %}
  </tr>
  <tr></tr> <!-- 添加一个空行以匹配表头结构 -->

  {% for teacher_name, student_data in teacher_student_data.items %}
  <tr>
      <td rowspan="{{ student_data|length|add:1 }}">{{ teacher_name }}</td> <!-- 修正行跨度 -->
      {% for student_name in student_data %}
      <tr>
        <td>{{ student_name }}</td>
        {% for item in lunch_items %}
        {% with total=orders_detail|get_item:item.name|get_item:teacher_name %}
        {% if total %}
        {% with quantity=total.customers|get_item:student_name %}
        <td>{{ quantity|default:"-" }}</td>
        {% endwith %}
        {% else %}
        <td>-</td>
        {% endif %}
        {% endwith %}
        {% endfor %}
    </tr>
      {% endfor %}
      {% if teacher_name != '-' %}
      <tr>
          <td colspan="2">Total</td>
          {% for item in lunch_items %}
          {% with total=orders_detail|get_item:item.name|get_item:teacher_name %}
        <td>{{ total.group_quantity|default:"-" }}</td>
        {% endwith %}
          {% endfor %}
      </tr>
      {% endif %}
  {% endfor %}

  <tr class="total-quantity-row">
    <td colspan="2">Total Quantity</td>
    {% for item in lunch_items %}
    <td>{{total_quantity_of_all_lunch_item|get_item:item.name}}</td>
    {% endfor %}
  </tr>

</table>
{% endblock %}


